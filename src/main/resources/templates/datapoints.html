<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head lang="en">

    <title>datapoints</title>

    <!--/*/ <th:block th:include="fragments/headerinc :: head"></th:block> /*/-->
</head>


<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>


<script type="text/javascript">

	$(document).ready(function() {
        console.log("document ready...")

		$.ajax({
			type : 'GET',
			headers : {
				Accept : "application/json; charset=utf-8",
				"Content-Type" : "application/json; charset=utf-8"
			},
			url : '/api/datapoints',
			success : function(result) {
			    console.log("ajax success ...");
                google.charts.load('current', {
					'packages' : [ 'corechart' ]
				});

                var dataArray = [];
    
	    		$.each(result, function(i, obj) {
                    var date = new Date(obj.time);
                    dataArray.push([ date, obj.tempHi, obj.tempLo ]);
                });

				google.charts.setOnLoadCallback(function() {
					drawChart(dataArray);
				});
			}
		});

        function drawChart(dataArray) {
            console.log("drawChart called... ",dataArray);
            google.charts.load('current', {'packages':['corechart']});

            var data = new google.visualization.DataTable();
            data.addColumn('datetime', 'Time');
            data.addColumn('number', 'Highest Temperature');
            data.addColumn('number', 'Lowest Temperature');
            data.addRows(dataArray);

            var options = {
                title: 'Temperature',
                curveType: 'function',
                legend: { position: 'bottom' }
            };

            var chart = new google.visualization.LineChart(document.getElementById('curve_chart'));
            chart.draw(data, options);
        }
    });


</script>

<body>

<div class="container">
    <!--/*/ <th:block th:include="fragments/header :: header"></th:block> /*/-->
    <div>
        <h2>Daily datapoints</h2>
    </div>
    <div id="curve_chart" style="width: 900px; height: 500px"></div>

</div>
</body>
</html>